# Test info

- Name: Bulletin >> Send Image Reply >> verify send a image reply successfully
- Location: /Users/babuyadav/Documents/zillit-playwright-automation/src/tests/bulletinTest.spec.js:257:9

# Error details

```
Error: locator.fill: Target page, context or browser has been closed
Call log:
  - waiting for locator('textarea[placeholder="Type a message"]')

    at UploadMedia.imageReply (/Users/babuyadav/Documents/zillit-playwright-automation/src/actions/media-uploader.js:311:32)
    at /Users/babuyadav/Documents/zillit-playwright-automation/src/tests/bulletinTest.spec.js:261:13
```

# Page snapshot

```yaml
- complementary:
  - img "Zillit Logo"
  - img
  - paragraph: Turn on Notification
  - paragraph: Get notified of a new message or call on computer.
  - button "Turn on desktop notification"
  - menu:
    - menuitem "FilmTools Logo Home":
      - img "FilmTools Logo"
      - text: Home
    - menuitem "Email":
      - img
      - text: Email
    - menuitem "FilmTools Logo Tools":
      - img "FilmTools Logo"
      - text: Tools
    - menuitem "FilmTools Logo C & C":
      - img "FilmTools Logo"
      - text: C & C
    - menuitem "FilmTools Logo Settings":
      - img "FilmTools Logo"
      - text: Settings
    - menuitem "FilmTools Logo SOS":
      - img "FilmTools Logo"
      - text: SOS
    - menuitem "question Zillit Help":
      - img "question"
      - text: Zillit Help
    - menuitem "poweroff Logout":
      - img "poweroff"
      - text: Logout
  - img "user"
  - button "Zl automation51 down":
    - strong: Zl automation51
    - img "down"
  - superscript
- main:
  - tablist:
    - tab "Bulletin" [selected]
    - tab "Calendar"
    - tab "Call Sheet"
  - tabpanel "Bulletin"
  - text: B Babu Web (Caterers)
  - img "Image"
  - text: File Size - 200.06 KB Aug 26, 2025 at 11:50 AM
  - img "down"
  - button
  - button "paper-clip":
    - img "paper-clip"
  - img "smile"
  - textbox "Type your message"
  - button "audio":
    - img "audio"
  - button "search":
    - img "search"
- dialog:
  - button "edit":
    - img "edit"
  - button "Send"
  - button "Close"
  - img
  - textbox "Type a message"
```

# Test source

```ts
  211 |         await this.dropDownListOnReply('Delete');
  212 |         await this.page.getByRole('button', { name: 'Ok' }).click();
  213 |
  214 |         const popup = this.page.locator("text=Comment deleted successfully!");
  215 |         await expect(popup).toBeVisible({timeout: 20000});
  216 |         await expect(popup).toBeHidden({timeout: 20000});
  217 |     }
  218 |
  219 |     async delete(){
  220 |         logger.info('[Delete] deletion started...');
  221 |
  222 |         await this.handleDropdownAction('Delete');
  223 |
  224 |         await this.deleteIcon.click();
  225 |         await this.deleteOk.click();
  226 |
  227 |         const popup = this.page.locator("text=Message Deleted successfully");
  228 |         console.log('Waiting for popup to appear...');
  229 |         await expect(popup).toBeVisible({timeout: 20000});
  230 |         console.log('Waiting for popup to disappear...');
  231 |         await expect(popup).toBeHidden({timeout: 20000});
  232 |     } 
  233 |     
  234 |     async clickAttachment(){
  235 |         await this.attachmentButton.click();
  236 |     }
  237 |
  238 |     async uploadImage(){
  239 |         logger.info('[Media] Upload image started...');
  240 |
  241 |         await this.imageUploadButton.setInputFiles(mediapaths.image);
  242 |     }
  243 |
  244 |     async clickSendMedia(){
  245 |         await this.sendMedia.click();
  246 |         
  247 |         // Wait for "sending" (case-insensitive) to appear
  248 |         await this.page.waitForSelector('text=/sending/i', { state: 'visible' });
  249 |
  250 |         // Wait for "sending" (case-insensitive) to disappear
  251 |         await this.page.waitForSelector('text=/sending/i', { state: 'hidden' });
  252 |
  253 |         // Wait for "File Size" (case-insensitive) to appear
  254 |         await this.page.waitForSelector('text=/file size/i', { state: 'visible' });
  255 |     }
  256 |
  257 |     async uploadVideo(){
  258 |         logger.info('[Media] Upload video started...');
  259 |
  260 |         await this.videoUploadButton.setInputFiles(mediapaths.video);
  261 |     }
  262 |
  263 |     async uploadAudio(){
  264 |         logger.info('[Media] Upload audio started...');
  265 |
  266 |         await this.audioUploadButton.setInputFiles(mediapaths.audio);
  267 |         await this.page.locator("text=Send").click();
  268 |         await this.page.locator('[class="w-4 h-4 text-white dark:text-white "]').waitFor({ state: 'visible' });
  269 |     }
  270 |
  271 |     async uploadDocument(){
  272 |         logger.info('[Media] Upload document started...');
  273 |
  274 |         await this.documentUploadButton.setInputFiles(mediapaths.document);
  275 |         await this.page.locator("text=Send").click();
  276 |     }
  277 |
  278 |     async uploadLocation(){
  279 |         logger.info('[Location] Upload location started...');
  280 |
  281 |         await this.locationUploadButton.waitFor({ state: 'visible' }),
  282 |         await this.locationUploadButton.click();
  283 |         await this.selectButton.waitFor({ state: 'visible' })
  284 |         await this.page.waitForTimeout(2000);
  285 |         await this.selectButton.click();
  286 |
  287 |         try{
  288 |         await this.page.waitForSelector('[aria-label="clock-circle"]', { state: 'hidden' });
  289 |         
  290 |         const image = this.page.locator('//img[@class="rounded-lg  object-cover h-[20rem] w-[100%]"]');
  291 |         await image.waitFor({ state: 'visible'});
  292 |
  293 |         const [newTab] = await Promise.all([
  294 |         this.page.context().waitForEvent('page'),
  295 |         image.click()
  296 |         ]);
  297 |
  298 |         await newTab.waitForLoadState();
  299 |         await newTab.close();
  300 |
  301 |         await this.page.bringToFront();
  302 |         }catch(error){
  303 |             console.log(`location is not clickable: ${error}`);
  304 |         }
  305 |     }
  306 |
  307 |     async imageReply(){
  308 |         logger.info('[ImageReply] Started image reply message...');
  309 |         
  310 |         await this.handleDropdownAction('Image Reply');
> 311 |         await this.typeMessage.fill('This is image reply');
      |                                ^ Error: locator.fill: Target page, context or browser has been closed
  312 |         await this.clickSendMedia();
  313 |     }
  314 |
  315 |
  316 |     
  317 |     async deleteAll(){
  318 |         await this.page.waitForTimeout(1000);
  319 |
  320 |         const items = this.page.locator('.dropDown');
  321 |         const totalCount = await items.count();
  322 |
  323 |         console.log(`total message: ${totalCount}`);
  324 |
  325 |         if (totalCount === 0) {
  326 |             console.log('No elements found to hover on.');
  327 |             return;
  328 |         }
  329 |
  330 |         // Hover and click the last dropdown icon
  331 |         const lastItem = items.nth(totalCount - 1);
  332 |         await lastItem.hover();
  333 |         await lastItem.click();
  334 |
  335 |         // Wait for dropdown to be visible (not hidden)
  336 |         const dropdown = this.page.locator('div.ant-dropdown:not(.ant-dropdown-hidden)');
  337 |         await dropdown.waitFor({ state: 'visible', timeout: 5000 });
  338 |
  339 |         const options = dropdown.locator('li');
  340 |         const count = await options.count();
  341 |
  342 |         // Get all <li> items from the dropdown
  343 |         console.log('Dropdown options:');
  344 |         for (let i = 0; i < count; i++) {
  345 |             const text = await options.nth(i).textContent();
  346 |             console.log(text);
  347 |         }
  348 |
  349 |         // Click on the 'Delete' option
  350 |         await options.filter({ hasText: 'Delete' }).first().click();
  351 |
  352 |         // âœ… Wait for checkboxes to appear (optional timeout)
  353 |         await this.page.waitForTimeout(1000);
  354 |         const checkboxes = this.page.locator('.ant-checkbox-input');
  355 |         const checkboxCount = await checkboxes.count();
  356 |         console.log(`Total checkboxes: ${checkboxCount}`);
  357 |
  358 |         for (let i = 0; i < checkboxCount; i++) {
  359 |         const checkbox = checkboxes.nth(i);
  360 |         const isChecked = await checkbox.evaluate(el => el.checked);
  361 |         if (!isChecked) {
  362 |             await checkbox.click();
  363 |             await this.page.waitForTimeout(500); // optional wait between clicks
  364 |             }
  365 |         }
  366 |
  367 |         await this.deleteIcon.click();
  368 |         await this.deleteOk.click();
  369 |
  370 |         const popup = this.page.locator("text=Message Deleted successfully");
  371 |         console.log('Waiting for popup to appear...');
  372 |         await expect(popup).toBeVisible({timeout: 20000});
  373 |         console.log('Waiting for popup to disappear...');
  374 |         await expect(popup).toBeHidden({timeout: 20000});
  375 |     }
  376 |
  377 | }
```